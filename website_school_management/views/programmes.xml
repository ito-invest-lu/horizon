<?xml version="1.0" encoding="utf-8" ?>
<odoo>

    <!-- //////////////////////////////////////////////////////////////// -->
    <!-- //                     LISTE PROGRAMMES                       // -->
    <!-- //////////////////////////////////////////////////////////////// -->

    <template id="programmes_liste">
        <t t-set="additional_title">Programmes</t>
        <t t-call="website.layout"> <!-- Affiche le layout du site web -->
            <div class="container my-5">
                <div class="row">
                    <div class="col-12">
                        <h1 class="mb-3">Programmes</h1>
                        <div class="mt-4">
                            <t t-call="website_school_management.programmes_breadcrumb"/>
                            <div class="breadcrumb_next_step mb-4" t-if="len(options) != 0">
                                <span class="fw-bold d-flex align-items-center"><i class="fa fa-filter fs-4 me-1 accented-color" aria-hidden="true"></i>Sélectionner :</span>
                                <t t-foreach="options" t-as="option">
                                    <a t-att-title="'Sélectionner ' + option['name']" class="btn btn-outline-primary btn-sm fw-bold" t-att-href="option ['uri']"><t t-esc="option['name']" /></a>
                                </t>
                            </div>
                            <hr class="my-0"/>
                        </div>
                    </div> 
                    <div class="col-12">
                        <t t-set="current_cycle" t-value="False"/>
                        <t t-set="d" t-value="False"/>
                        <t t-set="c" t-value="False"/>
                        <t t-foreach="program_list" t-as="program">
                            <t t-if="(current_cycle != False) and (current_cycle != program.cycle_id.id)" t-call="website_school_management.close_list" />
                            <t t-if="d != program.domain_name">
                                <h3 class="mt-4" t-esc="program.domain_name" />
                                <t t-set="d" t-value="program.domain_name"/>
                                <t t-set="c" t-value="False"/>
                            </t>
                            <t t-if="c != program.cycle_id">
                                <h4 class="ps-3 mt-4 mb-3" t-esc="program.cycle_id.name" />
                                <t t-set="c" t-value="program.cycle_id"/>
                            </t>
                            <t t-if="(current_cycle == False) or (current_cycle != program.cycle_id.id)" t-call="website_school_management.open_list" />
                            <li class="list-group-item">
                                <a t-att-href="'/programme/%s' %slug(program)" t-esc="program.name" />
                            </li>
                            <t t-set="current_cycle" t-value="program.cycle_id.id"/>
                            <t t-if="program_index == (len(program_list) - 1)" t-call="website_school_management.close_list" />
                        </t>
                    </div> 
                </div>    
            </div>    
        </t>
    </template>

    <!-- //////////////////////////////////////////////////////////////// -->
    <!-- //                     FICHE PROGRAMME                        // -->
    <!-- //////////////////////////////////////////////////////////////// -->

    <template id="programme_fiche">
        <t t-set="additional_title" t-value="program.title" />
        <t t-call="website.layout">
            <div class="container my-5">
                <div class="row">
                    <div class="col-12">
                        <div class="d-flex flex-column-reverse flex-sm-row align-items-center align-items-sm-start justify-content-sm-between gap-4">
                            <h1 t-esc="program.name" />
                            <a class="d-flex gap-3 align-items-center justify-content-center btn btn-primary h-fit-content w-fit-content" t-att-href="'/impression_programme/%s' %slug(program)" target="new" title="Imprimer le programme de cours" >
                                <span class="d-sm-none fw-bold">Imprimer le programme</span>
                                <i class="fa fa-print fs-3" aria-hidden="true"></i>
                                <span class="sr-only">Imprimer le programme de cours</span>
                            </a> 
                        </div>
                        <div class="mt-4">
                            <t t-call="website_school_management.programmes_breadcrumb"/>
                            <hr class="mt-0 mb-4"/>
                        </div>
                        <t t-call="website_school_management.programme_details_contenu"/>
                    </div> 
                </div>    
            </div>    
        </t>
    </template>

    <template id="programme_details_contenu" name="Program Details Content">
        <dl class="d-flex flex-wrap pt-2 mb-4">
            <div class="flex-grow-1">
                <dt class="border text-center d-block w-100 py-2 px-3 o_cc5">Domaine</dt>
                <dd class="border text-center border-top-0 d-block w-100 py-2 px-3 mb-3" t-esc="program.domain_name" />
            </div>
            <div class="flex-grow-1">
                <dt class="border text-center d-block w-100 py-2 px-3 o_cc5">Cycle</dt>
                <dd class="border text-center border-top-0 d-block w-100 py-2 px-3 mb-3" t-esc="program.cycle_id.name" />
            </div>
            <div class="flex-grow-1">
                <dt class="border text-center d-block w-100 py-2 px-3 o_cc5">Section</dt>
                <dd class="border text-center border-top-0 d-block w-100 py-2 px-3 mb-3" t-esc="program.speciality_id.section_id.name" />
            </div>
            <div class="flex-grow-1">
                <dt class="border text-center d-block w-100 py-2 px-3 o_cc5">Orientation</dt>
                <dd class="border text-center border-top-0 d-block w-100 py-2 px-3 mb-3" t-esc="program.speciality_id.track_id.name" />
            </div>
            <div class="flex-grow-1">
                <dt class="border text-center d-block w-100 py-2 px-3 o_cc5">Spécialité</dt>
                <dd class="border text-center border-top-0 d-block w-100 py-2 px-3 mb-3" t-esc="program.speciality_id.name" />
            </div>
        </dl>
        <div t-if="program.description">
            <h2 class="mb-4">Vade-mecum</h2>
            <p t-esc="program.description"/>
        </div>
            <hr class="my-4"/>
        <div>
            <h2 class="mb-4">Programme des cours</h2>
            <div class="accordion -accordion-program_detail" id="program_detail">
                <div t-foreach="program.bloc_ids" t-as="bloc">
                    <t t-call="website_school_management.school_bloc_contenu"/>
                </div>
            </div>
        </div>
    </template>

    <template id="school_bloc_contenu" name="Bloc">
        <div class="accordion-item border mb-4">
            <h3 class="accordion-header">
                <button class="accordion-button" type="button" data-bs-toggle="collapse" t-attf-data-bs-target="#collapse{{bloc.id}}" aria-expanded="true" t-attf-aria-controls="collapse{{bloc.id}}">
                        <div class="d-flex flex-column">
                            <span class="fs-2"><t t-esc="bloc.name"/></span>
                            <div class="mt-2 d-flex gap-2">
                                <span>
                                    Heures&amp;nbsp;: 
                                    <span class="fw-bold accented-color" t-esc="bloc.total_hours"/>
                                </span>
                                <span>|</span>
                                <span>
                                    ECTS&amp;nbsp;: 
                                    <span class="fw-bold accented-color" t-esc="bloc.total_credits"/>
                                </span>
                            </div>
                        </div>
                </button>
            </h3>
            <div t-attf-id="collapse{{bloc.id}}" class="accordion-collapse collapse" aria-labelledby="headingOne" data-bs-parent="#program_detail">
                <div class="accordion-body border-top pt-2 pt-lg-0 px-2 px-lg-4">
                    <t t-set="course_group_group" t-value=""/>
                    <!-- Groupes de cours -->
                    <t t-foreach="bloc.course_group_ids.sorted(key=lambda r: r.cg_grouping_sequence)" t-as="course_group">
                        <!-- Groupe du groupe de cours -->
                        <t t-if="course_group.cg_grouping.id and course_group.cg_grouping.id != course_group_group">
                            <h4 class="mt-5" t-esc="course_group.cg_grouping.name"/>
                        </t>
                        <t t-set="course_group_group" t-value="course_group.cg_grouping.id"/>
                        <h5 class="group-title w-fit-content border border-bottom-0 d-flex flex-column gap-2 mt-3 mt-lg-5 mb-0 py-2 px-4">
                            <span class="d-flex flex-wrap gap-2">
                            <span class="d-none d-lg-inline">Unité d’enseignement&amp;nbsp;: </span><a class="link-primary d-block p-0" t-esc="course_group.title" t-att-href="'/groupe_de_cours/%s' % slug(course_group)" target="_self"/>
                            </span>
                            <span class="d-flex flex-wrap gap-2 fs-6">
                                <span class="d-none d-lg-inline">Responsable&amp;nbsp;:</span>
                                <span class="d-inline d-lg-none">Resp.:</span>
                                <span class="fw-normal fst-italic">
                                    <t t-esc="course_group.responsible_id.name"/>
                                </span>
                            </span>
                        </h5>
                        <div class="group-content p-3 mb-4 border">
                            <div class="px-3">
                                <div class="table-responsive mt-3 mb-2 mb-lg-4">
                                    <div class="table-row header o_cc5">
                                        <div class="cell border">
                                            Code
                                        </div>
                                        <div class="cell border">
                                            Heures
                                        </div>
                                        <div class="cell border">
                                            ECTS
                                        </div>
                                        <div class="cell border">
                                            Pré-requis
                                        </div>
                                        <div class="cell border">
                                            Co-requis
                                        </div>
                                        <div class="cell border">
                                            Obligatoire
                                        </div>
                                    </div>
                                    <div class="table-row">
                                        <div class="cell border" data-title="Code">
                                            <span class="cell-value">
                                                <t t-esc="course_group.ue_id"/>
                                            </span>
                                        </div>
                                        <div class="cell border" data-title="Heures">
                                            <span class="cell-value">
                                                <t t-esc="course_group.total_hours"/>
                                            </span>
                                        </div>
                                        <div class="cell border" data-title="ECTS">
                                            <span class="cell-value">
                                                <t t-esc="course_group.total_credits"/>
                                            </span>
                                        </div>
                                        <div class="cell border" data-title="Pré-requis">
                                            <span class="cell-value">
                                                <t t-if="course_group.pre_requisit_ids"><span t-esc="', '.join(map( lambda x: str(x.preriquisit_id.uid), course_group.pre_requisit_ids))"/></t>
                                                <t t-if="not(course_group.pre_requisit_ids)">/</t>
                                            </span>
                                        </div>
                                        <div class="cell border" data-title="Co-requis">
                                            <span class="cell-value">
                                                <t t-if="course_group.co_requisit_ids"><span t-esc="', '.join(map( lambda x: str(x.coriquisit_id.uid), course_group.co_requisit_ids))"/></t>
                                                <t t-if="not(course_group.co_requisit_ids)">/</t>
                                            </span>
                                        </div>
                                        <div class="cell border" data-title="Obligatoire">
                                            <span class="cell-value">
                                                <t t-if="course_group.mandatory">Oui</t><t t-if="not(course_group.mandatory)">Non</t>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <t t-if="course_group.course_ids">
                                <div class="block-cours">
                                <h6 class="fs-5 -cours">Cours</h6>
                                <div class="table-responsive mb-lg-3">
                                    <div class="table-row -cours header o_cc5">
                                        <div class="cell border">
                                            Nom
                                        </div>
                                        <div class="cell border">
                                            Heures
                                        </div>
                                        <div class="cell border">
                                            ECTS
                                        </div>
                                        <div class="cell border">
                                            Pondération
                                        </div>
                                        <div class="cell border">
                                            Quadri
                                        </div>
                                    </div>
                                    <t t-foreach="course_group.course_ids" t-as="course">
                                        <div class="table-row -cours">
                                            <div class="cell cell-name border" data-title="Nom">
                                                <span class="cell-value">
                                                    <a class="link-primary p-0" t-esc="course.title" t-att-href="'/cours/%s' % slug(course)" target="new"/>
                                                </span>
                                            </div>
                                            <div class="cell border" data-title="Heures">
                                                <span class="cell-value">
                                                    <t t-esc="course.hours"/>
                                                </span>
                                            </div>
                                            <div class="cell border" data-title="ECTS">
                                                <span class="cell-value">
                                                    <t t-esc="course.credits"/>
                                                </span>
                                            </div>
                                            <div class="cell border" data-title="Pondération">
                                                <span class="cell-value">
                                                    <t t-esc="course.weight"/>
                                                </span>
                                            </div>
                                            <div class="cell border" data-title="Quadri">
                                                <t t-if="course.quadri">
                                                    <span class="cell-value">
                                                        <t t-esc="course.quadri"/>
                                                    </span>
                                                </t>
                                                <t t-else="">
                                                    <span class="cell-value">
                                                    /
                                                    </span>
                                                </t>
                                            </div>
                                        </div>
                                    </t>
                                </div>
                                </div>    
                            </t>
                        </div>
                    </t>
                </div>
            </div>    
        </div>
    </template>

    <!-- //////////////////////////////////////////////////////////////// -->
    <!-- //                   FICHE GROUPE DE COURS                    // -->
    <!-- //////////////////////////////////////////////////////////////// -->

    <!-- TODO à adapter -->
    <template id="groupe_de_cours_fiche">
        <t t-set="additional_title" t-value="course_group.title" />
        <t t-call="website.layout"> <!-- Affiche le layout du site web -->
            <div class="container">
                <h1>Groupe de cours : <t t-esc="course_group.title"/></h1>
                <ul>
                    <li>Code : <span t-field="course_group.uid"/></li>
                    <li>Cycle : <span t-field="course_group.cycle_id.grade"/></li>
                    <li>Professeur : <span t-field="course_group.responsible_id"/></li>
                    <li>Période : <span t-field="course_group.period"/></li>
                    <li>Crédits : <span t-field="course_group.total_credits"/></li>
                    <li>Heures : <span t-field="course_group.total_hours"/></li>
                    <li>Obligatoire : <t t-if="course_group.mandatory">Oui</t><t t-if="not(course_group.mandatory)">Non</t></li>
                    <li>Cours : 
                        <t t-foreach="course_group.course_ids" t-as="course">
                            <ul>
                                <li>Nom : <a t-esc="course.title" t-att-href="'/cours/%s' % slug(course)" target="new"/></li>
                                <li>Heures : <t t-esc="course.hours"/></li>
                                <li>ECTS : <t t-esc="course.credits"/></li>
                                <li>Pondération : <t t-esc="course.weight"/></li>
                                <li>Quadri : <t t-esc="course.quadri"/></li>
                                <li>Professeurs : <span t-esc="', '.join(map( lambda x: x.name, course.teacher_ids))"/></li>
                            </ul>
                            <br/>
                        </t>
                    </li>
                </ul>                           
            </div>
        </t>
    </template>

    <!-- TODO à adapter -->
    <template id="groupe_de_cours_fiche_vide">
        <t t-set="additional_title">Groupe de cours</t>
        <t t-call="website.layout"> <!-- Affiche le layout du site web -->
            <t t-set="title">Groupe de cours</t>
            <div class="container">
                <h1>Pas de description</h1>      
                <p>Veuillez contacter le secrétariat ou votre professeur pour obtenir plus d'informations sur cette activité.</p>
                <hr/>
                <p style="text-align: center;"><a href="/programmes">Retour à la recherche</a></p>
            </div>
        </t>
    </template>

    <!-- //////////////////////////////////////////////////////////////// -->
    <!-- //                        FICHE COURS                         // -->
    <!-- //////////////////////////////////////////////////////////////// -->

    <template id="cours_fiche">
        <t t-set="additional_title" t-value="course_docs[0].name" />
        <t t-call="website.layout"> <!-- Affiche le layout du site web -->
            <div class="container">
                <t t-foreach="course_docs" t-as="course_doc"> <!-- Problème car avec plusieurs course_doc, potentielle répétition -->
                    <t t-call="website_school_management.cours_fiche_details" />
                </t>
            </div>
        </t>      
    </template>

  
  
    <template id="cours_fiche_details">
        <div>
            <h1><t t-if="course_doc.state == 'draft'">Brouillon - </t>Détails du cours : <span t-field="course_doc.name"/></h1>
            <h3>par <span t-field="course_doc.author_id"/></h3>
        </div>
        <div>
            <ul>
                <li>Cycle : <span t-field="course_doc.cycle_id"/></li>
                <li>Groupe de cours : <span t-field="course_doc.course_group_id.ue_id"/> - <span t-field="course_doc.course_group_id"/></li>
                <li>Niveau : <span t-field="course_doc.level"/></li>
                <li>Crédits : <span t-field="course_doc.credits"/></li>
                <li>Heures : <span t-field="course_doc.hours"/></li>
                <li>Pondération : <span t-field="course_doc.weight"/></li>
                <li>Obligatoire : <t t-if="course_doc.mandatory">Oui</t><t t-if="not(course_doc.mandatory)">Non</t></li>
                <li>Langue : <span t-field="course_doc.language"/></li>
                <li>Professeurs : <span t-esc="', '.join(map( lambda x: x.name, course_doc.staff_ids))"/></li>
            </ul>
        </div>

        <div>
            <h3 class="panel-title">Horaire - <span t-field="course_doc.schedule"/></h3>
            <span t-raw="course_doc.schedule_text"/>
        </div>
        <div>
            <h3 class="panel-title">Contenu</h3>
            <span t-raw="course_doc.content"/>
        </div>
        <div>
            <h3 class="panel-title">Méthode</h3>
            <span t-raw="course_doc.method"/>
        </div>
        <div>
            <h3 class="panel-title">Résultats d'apprentissage</h3>
            <span t-raw="course_doc.learning_outcomes"/>
        </div>
        <div>
            <h3 class="panel-title">Références</h3>
            <span t-raw="course_doc.references"/>
        </div>
        <div>
            <h3 class="panel-title">Pré-requis/Co-requis</h3>
            <span t-raw="course_doc.pre_co_requiered"/>
        </div>
        <div>
            <h3 class="panel-title">Méthode d'évaluation</h3>
            <span t-raw="course_doc.evaluation_method"/>
        </div>
    </template>

    <template id="cours_fiche_vide">
        <t t-call="website.layout"> <!-- Affiche le layout du site web -->
            <t t-set="title">Cours</t>
            <div class="container">
                <h1>Pas de description</h1>      
                <p>Veuillez contacter le secrétariat ou votre professeur pour obtenir plus d'informations sur cette activité.</p>
            </div>
        </t>
    </template>
    
    <!-- //////////////////////////////////////////////////////////////// -->
    <!-- //                         BREADCRUMB                         // -->
    <!-- //////////////////////////////////////////////////////////////// -->

    <template id="programmes_breadcrumb">
        <t t-if="len(breadcrumb) != 1">
            <div class="breadcrumb mb-4">
                <t t-set="count" t-value="1" />
                <t t-foreach="breadcrumb" t-as="breadcrumb_item">
                    <t t-if="count == len(breadcrumb)">
                        <span class="breadcrumb-elem -active" ><t t-esc="breadcrumb_item['name']" /></span>
                    </t>
                    <t t-else="1">
                        <a t-att-title="'Retourner à ' + breadcrumb_item['name']" class="breadcrumb-elem" t-att-href="breadcrumb_item['uri']"><t t-esc="breadcrumb_item['name']" /></a>
                        <t t-set="count" t-value="count + 1" />
                    </t>
                </t>
            </div>
        </t>
    </template>

    <!-- //////////////////////////////////////////////////////////////// -->
    <!-- //                             LIST                           // -->
    <!-- //////////////////////////////////////////////////////////////// -->
    
    <template id="open_list">
        &lt;ul class="ps-3 ps-sm-5 list-group"&gt;
    </template>

    <template id="close_list">
        &lt;/ul&gt;
    </template>
    
</odoo>