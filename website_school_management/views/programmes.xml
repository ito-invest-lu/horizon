<?xml version="1.0" encoding="utf-8" ?>
<odoo>

    <!-- //////////////////////////////////////////////////////////////// -->
    <!-- //                       PROGRAMMES                           // -->
    <!-- //////////////////////////////////////////////////////////////// -->

    <template id="programmes">
        <t t-call="website.layout"> <!-- Affiche le layout du site web -->
            <t t-set="title">Programmes</t>
            <div class="container">
                <t t-if="len(program_list) == 0">
                    <t t-call="website_school_management.programmes_vide"/>
                </t>
                <t t-else="1">
                    <t t-call="website_school_management.programmes_liste"/>
                </t>
            </div>
        </t>
    </template>

    <!-- //////////////////////////////////////////////////////////////// -->
    <!-- //                     LISTE PROGRAMMES                       // -->
    <!-- //////////////////////////////////////////////////////////////// -->

    <!-- TODO à adapter -->
    <template id="programmes_liste">
        <h1 t-esc="title"/>
        <div class="oe_structure" />
        <t t-call="website_school_management.programmes_breadcrumb"/>
        <br/>
        <div class="my-2">
        <t t-foreach="options" t-as="option">
            <a class="btn btn-primary my-1" t-att-href="option['uri']"><t t-esc="option['name']" /></a>
        </t>
        </div>
        <t t-else="1"> 
            <div class="row">
                <t t-set="d" t-value="False"/>
                <t t-set="c" t-value="False"/>
                <t t-foreach="program_list" t-as="program">
                    <div class="col-12">
                        <t t-if="d != program.domain_name">
                            <h3><t t-esc="program.domain_name" /></h3>
                            <t t-set="d" t-value="program.domain_name"/>
                            <t t-set="c" t-value="False"/>
                        </t>
                        <t t-if="c != program.cycle_id">
                            <h4><t t-esc="program.cycle_id.name" /></h4>
                            <t t-set="c" t-value="program.cycle_id"/>
                        </t>
                        <div class="thumbnail oe_school_program">
                            <div class="caption">
                                <a t-att-href="program.program_uri"><t t-esc="program.name" /></a>
                            </div>
                        </div>
                    </div>
                </t>
            </div> 
        </t> 
    </template>

    <!-- //////////////////////////////////////////////////////////////// -->
    <!-- //                PAS DE RESULTATS (PROGRAMMES)               // -->
    <!-- //////////////////////////////////////////////////////////////// -->

    <!-- TODO à adapter -->
    <template id="programmes_vide">
        <h1 t-esc="title"/>
        <div class="oe_structure">
            <p>Aucun programme de cours correspondant.</p>
            <hr/>
            <p style="text-align: center;"><a href="/programmes">Retour à la recherche</a></p>
        </div>        
    </template>

    <!-- //////////////////////////////////////////////////////////////// -->
    <!-- //                     FICHE PROGRAMME                        // -->
    <!-- //////////////////////////////////////////////////////////////// -->

    <!-- TODO à adapter -->
    <template id="programme_fiche">
    <t t-call="website.layout">
        <t t-set="title" t-value="program.name" />
        <div class="container">
            <h2>Détails du programme</h2>
            <div>  
                <a class="btn btn-default" t-att-href="'/impression_programme/%s' % program.id" target="new">
                    <i class="fa fa-print fa-2x" title="Imprimer" aria-hidden="true"></i>
                    <span class="sr-only">Imprimer</span>
                </a> 
            </div>
            <hr/>
            <t t-call="website_school_management.programmes_breadcrumb"/>
            <hr/>
            <t t-call="website_school_management.programme_details_contenu"/>
        </div>
    </t>
    </template>

    <!-- TODO à adapter -->
   <template id="programme_details_contenu" name="Program Details Content">
        <div>
            <h4>PROFIL D’ENSEIGNEMENT</h4>
            <h4><t t-esc="program.name" /></h4>
        </div>
        <hr/>
        <div>
            <div>
                <p>DOMAINE</p>
                <p><t t-esc="program.domain_name" /></p>
            </div>
            <div>
                <p>CYCLE</p>
                <p><t t-esc="program.cycle_id.name" /></p>
            </div>
            <div>
                <p>SECTION</p>
                <p><t t-esc="program.speciality_id.section_id.name" /></p>
            </div>
            <div>
                <p>ORIENTATION</p>
                <p><t t-esc="program.speciality_id.track_id.name" /></p>
            </div>
            <div>
                <p>SPÉCIALITÉ</p>
                <p><t t-esc="program.speciality_id.name" /></p>
            </div>
        </div>
        <hr/>
        <div t-if="program.description">
            <h4>VADE MECUM</h4>
            <p><t t-esc="program.description"/></p>
            <hr/>
        </div>
        <div>
            <h4>PROGRAMME DES COURS</h4>
            <div t-foreach="program.bloc_ids" t-as="bloc">
                <t t-call="website_school_management.school_bloc_contenu"/>
            </div>
        </div>
        <hr/>
    </template>

    <!-- TODO à adapter -->
    <template id="school_bloc_contenu" name="Bloc">
        <div>
            <h5>Grille du bloc - <t t-esc="bloc.name"/></h5>
            <div>
                <div>
                    <t t-set="course_group_group" t-value=""/>
                    <!-- Groupes de cours -->
                    <t t-foreach="bloc.course_group_ids.sorted(key=lambda r: r.cg_grouping_sequence)" t-as="course_group">
                        <!-- Groupe du groupe de cours -->
                        <t t-if="course_group.cg_grouping.id and course_group.cg_grouping.id != course_group_group">
                            <hr/>
                            <h6>Groupe des groupes de cours : <t t-esc="course_group.cg_grouping.name"/></h6>
                            <hr/>
                        </t>
                        <t t-set="course_group_group" t-value="course_group.cg_grouping.id"/>
                        <ul>
                            <!-- Groupe de cours -->
                            <li>Code : <t t-esc="course_group.ue_id"/></li>
                            <li>Unités d’enseignement (groupe de cours) : <a t-esc="course_group.title" t-att-href="'/groupe_de_cours/%s' % slug(course_group)" target="_self"/></li>
                            <li>Professeur : <t t-esc="course_group.responsible_id.name"/></li>
                            <li>Heures : <t t-esc="course_group.total_hours"/></li>
                            <li>ECTS : <t t-esc="course_group.total_credits"/></li>
                            <li>Pré-requis : <t t-if="course_group.pre_requisit_ids"><span t-esc="', '.join(map( lambda x: str(x.preriquisit_id.uid), course_group.pre_requisit_ids))"/></t></li>
                            <li>Co-requis : <t t-if="course_group.co_requisit_ids"><span t-esc="', '.join(map( lambda x: str(x.coriquisit_id.uid), course_group.co_requisit_ids))"/></t></li>
                            <li>Obligatoire : <t t-if="course_group.mandatory">Oui</t><t t-if="not(course_group.mandatory)">Non</t></li>
                            <!-- Liste de cours -->
                            <li>Cours : 
                                <t t-foreach="course_group.course_ids" t-as="course">
                                    <ul>
                                        <li>Nom : <a t-esc="course.title" t-att-href="'/cours/%s' % slug(course)" target="new"/></li>
                                        <li>Heures : <t t-esc="course.hours"/></li>
                                        <li>ECTS : <t t-esc="course.credits"/></li>
                                        <li>Pondération : <t t-esc="course.weight"/></li>
                                        <li>Quadri : <t t-esc="course.quadri"/></li>
                                    </ul>
                                    <br/>
                                </t>
                            </li>
                            <hr/>
                        </ul>
                    </t>
                    <!-- Total -->
                    <p>Total :</p>
                    <ul>
                        <li>Heures : <t t-esc="bloc.total_hours"/></li>
                        <li>ECTS : <t t-esc="bloc.total_credits"/></li>
                    </ul>
                    <hr/>  
                </div>
            </div>    
        </div>
    </template>

    <!-- //////////////////////////////////////////////////////////////// -->
    <!-- //                   FICHE GROUPE DE COURS                    // -->
    <!-- //////////////////////////////////////////////////////////////// -->

    <!-- TODO à adapter -->
    <template id="groupe_de_cours_fiche">
        <t t-call="website.layout"> <!-- Affiche le layout du site web -->
            <t t-set="title" t-value="course_group.title"/>
            <div class="container">
                <h1>Groupe de cours : <t t-esc="title"/></h1>
                <ul>
                    <li>Code : <span t-field="course_group.uid"/></li>
                    <li>Cycle : <span t-field="course_group.cycle_id.grade"/></li>
                    <li>Professeur : <span t-field="course_group.responsible_id"/></li>
                    <li>Période : <span t-field="course_group.period"/></li>
                    <li>Crédits : <span t-field="course_group.total_credits"/></li>
                    <li>Heures : <span t-field="course_group.total_hours"/></li>
                    <li>Obligatoire : <t t-if="course_group.mandatory">Oui</t><t t-if="not(course_group.mandatory)">Non</t></li>
                    <li>Cours : 
                        <t t-foreach="course_group.course_ids" t-as="course">
                            <ul>
                                <li>Nom : <a t-esc="course.title" t-att-href="'/cours/%s' % slug(course)" target="new"/></li>
                                <li>Heures : <t t-esc="course.hours"/></li>
                                <li>ECTS : <t t-esc="course.credits"/></li>
                                <li>Pondération : <t t-esc="course.weight"/></li>
                                <li>Quadri : <t t-esc="course.quadri"/></li>
                                <li>Professeurs : <span t-esc="', '.join(map( lambda x: x.name, course.teacher_ids))"/></li>
                            </ul>
                            <br/>
                        </t>
                    </li>
                </ul>                           
            </div>
        </t>
    </template>

    <!-- TODO à adapter -->
    <template id="groupe_de_cours_fiche_vide">
        <t t-call="website.layout"> <!-- Affiche le layout du site web -->
            <t t-set="title">Groupe de cours</t>
            <div class="container">
                <div class="oe_structure">
                    <h1>Pas de description</h1>      
                    <p>Veuillez contacter le secrétariat ou votre professeur pour obtenir plus d'informations sur cette activité.</p>
                    <hr/>
                    <p style="text-align: center;"><a href="/programmes">Retour à la recherche</a></p>
                </div>
            </div>
        </t>
    </template>

    <!-- //////////////////////////////////////////////////////////////// -->
    <!-- //                        FICHE COURS                         // -->
    <!-- //////////////////////////////////////////////////////////////// -->

    <template id="cours_fiche">
        <t t-call="website.layout"> <!-- Affiche le layout du site web -->
            <t t-set="title">Cours</t>
            <div class="container">
                <t t-foreach="course_docs" t-as="course_doc"> <!-- Problème car avec plusieurs course_doc, potentielle répétition -->
                    <t t-call="website_school_management.cours_fiche_details" />
                </t>
            </div>
        </t>      
    </template>

  <template id="cours_fiche_details">
        <div>
            <h1><t t-if="course_doc.state == 'draft'">Brouillon - </t>Détails du cours : <span t-field="course_doc.name"/></h1>
            <h3>par <span t-field="course_doc.author_id"/></h3>
        </div>
        <div>
            <ul>
                <li>Cycle : <span t-field="course_doc.cycle_id"/></li>
                <li>Groupe de cours : <span t-field="course_doc.course_group_id.ue_id"/> - <span t-field="course_doc.course_group_id"/></li>
                <li>Niveau : <span t-field="course_doc.level"/></li>
                <li>Crédits : <span t-field="course_doc.credits"/></li>
                <li>Heures : <span t-field="course_doc.hours"/></li>
                <li>Pondération : <span t-field="course_doc.weight"/></li>
                <li>Obligatoire : <t t-if="course_doc.mandatory">Oui</t><t t-if="not(course_doc.mandatory)">Non</t></li>
                <li>Langue : <span t-field="course_doc.language"/></li>
                <li>Professeurs : <span t-esc="', '.join(map( lambda x: x.name, course_doc.staff_ids))"/></li>
            </ul>
        </div>

        <div>
            <h3 class="panel-title">Horaire - <span t-field="course_doc.schedule"/></h3>
            <span t-raw="course_doc.schedule_text"/>
        </div>
        <div>
            <h3 class="panel-title">Contenu</h3>
            <span t-raw="course_doc.content"/>
        </div>
        <div>
            <h3 class="panel-title">Méthode</h3>
            <span t-raw="course_doc.method"/>
        </div>
        <div>
            <h3 class="panel-title">Résultats d'apprentissage</h3>
            <span t-raw="course_doc.learning_outcomes"/>
        </div>
        <div>
            <h3 class="panel-title">Références</h3>
            <span t-raw="course_doc.references"/>
        </div>
        <div>
            <h3 class="panel-title">Pré-requis/Co-requis</h3>
            <span t-raw="course_doc.pre_co_requiered"/>
        </div>
        <div>
            <h3 class="panel-title">Méthode d'évaluation</h3>
            <span t-raw="course_doc.evaluation_method"/>
        </div>
    </template>

    <template id="cours_fiche_vide">
        <t t-call="website.layout"> <!-- Affiche le layout du site web -->
            <t t-set="title">Cours</t>
            <div class="container">
                <h1>Pas de description</h1>      
                <p>Veuillez contacter le secrétariat ou votre professeur pour obtenir plus d'informations sur cette activité.</p>
            </div>
        </t>
    </template>
    
    <!-- //////////////////////////////////////////////////////////////// -->
    <!-- //                         BREADCRUMB                         // -->
    <!-- //////////////////////////////////////////////////////////////// -->

    <template id="programmes_breadcrumb">
        <t t-set="count" t-value="1" />
        <t t-foreach="breadcrumb" t-as="breadcrumb_item">
            <t t-if="count &lt; len(breadcrumb)">
                <a t-att-href="breadcrumb_item['uri']"><t t-esc="breadcrumb_item['name']" /></a>
                <t t-if="len(breadcrumb) != 1"><span> &gt; </span></t>
                <t t-set="count" t-value="count + 1" />
            </t>
            <t t-else="1">
                <span><t t-esc="breadcrumb_item['name']" /></span>
            </t>
        </t>
    </template>
  
</odoo>